@inject IDialogService DialogService

@implements IDisposable

@foreach (var f in _fragments.Reverse())
{
    @f
}

@code {
    private Stack<RenderFragment> _fragments = [];

    protected override void OnInitialized()
    {
        if (DialogService is not DialogService svc) return;

        svc.OnShow += ShowDialog;
        svc.OnClose += CloseDialog;
    }

    private void ShowDialog(RenderFragment frag)
    {
        _fragments.Push(frag);
        StateHasChanged();
    }

    private void CloseDialog()
    {
        if (_fragments.Count == 0) return;
        _fragments.Pop();
        StateHasChanged();
    }

    public void Dispose()
    {
        if (DialogService is not DialogService svc) return;

        svc.OnShow -= ShowDialog;
        svc.OnClose -= CloseDialog;
    }
}
