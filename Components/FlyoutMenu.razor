@using RTB.BlazorUI.Extensions
@using RTB.BlazorUI.Services.Theme.Themes
@using RTB.BlazorUI.Styles.Helper
@inherits RTBComponent

@code {
    [Parameter, EditorRequired] public RenderFragment Activator { get; set; } = default!;
    [Parameter, EditorRequired] public RenderFragment FlyoutContent { get; set; } = default!;
    [Parameter, EditorRequired] public FlyoutPosition Position { get; set; }

    [Parameter] public string? ActivatorClass { get; set; }
    [Parameter] public string? ContentClass { get; set; }

    private readonly string FlyoutId = $"flyout-{Guid.NewGuid().ToString("N").Substring(0, 8)}";
}

<Styled Context="ComponentClass">

    <button popovertarget="@FlyoutId" class="FlyoutMenuActivator @ComponentClass @Class @ActivatorClass" style="anchor-name: --@FlyoutId;">
        @Activator
    </button>

    <Styled Context="MenuClass">
        <Margin All="0" />
        <Other Property="position" Value="absolute" />
        <Other Property="insert" Value="auto" />
        <Other Property="position-area" Value="@Position.ToCss().Replace('-', ' ')" />
        <Overflow />
        <Size MinHeight="0" />
        <Other Property="max-width" Value="anchor-size(width)" />

        <div class="@MenuClass @ContentClass" popover id="@FlyoutId" style="position-anchor: --@FlyoutId;">
            @FlyoutContent
        </div>
    </Styled>
</Styled>

@code {
    public enum FlyoutPosition
    {
        TopLeft, Top, TopRight,
        BottomLeft, Bottom, BottomRight,
        LeftTop, Left, LeftBottom,
        RightTop, Right, RightBottom,
        Center
    }
}
